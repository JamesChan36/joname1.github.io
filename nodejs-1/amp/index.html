<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">

    <title>Node.js(1) 封装,调用,执行,访问路径,http,函数编程,等待函数,事件监听</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="江矿宝宝的博客." />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Node.js(1) 封装,调用,执行,访问路径,http,函数编程,等待函数,事件监听" />
    <meta property="og:description" content="1.如何封装一个模块； 首先，我们建立一个js文件，例如命名为test.js； 然后在里面写一个函数，函数名任意； 然后通过exports.变量名，将函数赋值给这个变量； 如代码：    function test(){    //请注意这个函数名       console.log(&quot;1&quot;); } exports.testBegin&#x3D; test;   //等号后面的test，指的是上面的函数名。等号前面的testBegin，是调用时的函数名（注意区别）   这个test.js的文件就写完了，这是一个模块，他的效果是调用该函数后，输出1； 另外，不要问我这个exports是什么，我暂时也不知道。 2.如何调用一个模块 在封装模块的前提下，我们新建一个文件，例如a.js，来调用之前封装的test.js模块； 方法是： var test &#x3D; require(&quot;./test&quot;);   //调用该模块   test.testBegin(" />
    <meta property="og:url" content="http://localhost:2368/nodejs-1/" />
    <meta property="article:published_time" content="2016-10-01T07:53:00.000Z" />
    <meta property="article:modified_time" content="2017-05-25T08:27:21.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Node.js(1) 封装,调用,执行,访问路径,http,函数编程,等待函数,事件监听" />
    <meta name="twitter:description" content="1.如何封装一个模块； 首先，我们建立一个js文件，例如命名为test.js； 然后在里面写一个函数，函数名任意； 然后通过exports.变量名，将函数赋值给这个变量； 如代码：    function test(){    //请注意这个函数名       console.log(&quot;1&quot;); } exports.testBegin&#x3D; test;   //等号后面的test，指的是上面的函数名。等号前面的testBegin，是调用时的函数名（注意区别）   这个test.js的文件就写完了，这是一个模块，他的效果是调用该函数后，输出1； 另外，不要问我这个exports是什么，我暂时也不知道。 2.如何调用一个模块 在封装模块的前提下，我们新建一个文件，例如a.js，来调用之前封装的test.js模块； 方法是： var test &#x3D; require(&quot;./test&quot;);   //调用该模块   test.testBegin(" />
    <meta name="twitter:url" content="http://localhost:2368/nodejs-1/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="江矿宝宝." />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "江矿宝宝的博客.",
        "logo": "http://localhost:2368/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "江矿宝宝.",
        "image": {
            "@type": "ImageObject",
            "url": "https://joe-10005639.cossh.myqcloud.com/jkbb.jpg",
            "width": 600,
            "height": 600
        },
        "url": "http://localhost:2368/author/jkbb/",
        "sameAs": [
            "https://joname1.github.io"
        ],
        "description": "伪前端攻城狮, 喜欢钻研新技术."
    },
    "headline": "Node.js(1) 封装,调用,执行,访问路径,http,函数编程,等待函数,事件监听",
    "url": "http://localhost:2368/nodejs-1/",
    "datePublished": "2016-10-01T07:53:00.000Z",
    "dateModified": "2017-05-25T08:27:21.000Z",
    "description": "1.如何封装一个模块； 首先，我们建立一个js文件，例如命名为test.js； 然后在里面写一个函数，函数名任意； 然后通过exports.变量名，将函数赋值给这个变量； 如代码：    function test(){    //请注意这个函数名       console.log(&quot;1&quot;); } exports.testBegin&#x3D; test;   //等号后面的test，指的是上面的函数名。等号前面的testBegin，是调用时的函数名（注意区别）   这个test.js的文件就写完了，这是一个模块，他的效果是调用该函数后，输出1； 另外，不要问我这个exports是什么，我暂时也不知道。 2.如何调用一个模块 在封装模块的前提下，我们新建一个文件，例如a.js，来调用之前封装的test.js模块； 方法是： var test &#x3D; require(&quot;./test&quot;);   //调用该模块   test.testBegin(",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.11" />
    <link rel="alternate" type="application/rss+xml" title="江矿宝宝的博客." href="../../rss/index.html" />

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,600,400" />
    <style amp-custom>
        /* ==========================================================================
           Table of Contents
           ========================================================================== */

        /*

            0. Normalize
            1. General
            2. Utilities
            3. AMP Post
            4. Footer

        */

        /* ==========================================================================
           0. normalize.css v3.0.3 | MIT License | git.io/normalize | (minified)
           ========================================================================== */

        html {
            font-family: sans-serif;

            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
        }
        body {
            margin: 0;
        }
        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        main,
        menu,
        nav,
        section,
        summary {
            display: block;
        }
        audio,
        canvas,
        progress,
        video {
            display: inline-block;
            vertical-align: baseline;
        }
        audio:not([controls]) {
            display: none;
            height: 0;
        }
        [hidden],
        template {
            display: none;
        }
        a {
            background-color: transparent;
        }
        a:active,
        a:hover {
            outline: 0;
        }
        abbr[title] {
            border-bottom: 1px dotted;
        }
        b,
        strong {
            font-weight: bold;
        }
        dfn {
            font-style: italic;
        }
        h1 {
            margin: 0.67em 0;
            font-size: 2em;
        }
        mark {
            background: #ff0;
            color: #000;
        }
        small {
            font-size: 80%;
        }
        sub,
        sup {
            position: relative;
            vertical-align: baseline;
            font-size: 75%;
            line-height: 0;
        }
        sup {
            top: -0.5em;
        }
        sub {
            bottom: -0.25em;
        }
        img {
            border: 0;
        }
        amp-img {
            border: 0;
        }
        svg:not(:root) {
            overflow: hidden;
        }
        figure {
            margin: 1em 40px;
        }
        hr {
            box-sizing: content-box;
            height: 0;
        }
        pre {
            overflow: auto;
        }
        code,
        kbd,
        pre,
        samp {
            font-family: monospace, monospace;
            font-size: 1em;
        }
        button,
        input,
        optgroup,
        select,
        textarea {
            margin: 0;
            color: inherit;
            font: inherit;
        }
        button {
            overflow: visible;
        }
        button,
        select {
            text-transform: none;
        }
        button,
        html input[type="button"],
        input[type="reset"],
        input[type="submit"] {
            cursor: pointer;

            -webkit-appearance: button;
        }
        button[disabled],
        html input[disabled] {
            cursor: default;
        }
        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0;
        }
        input {
            line-height: normal;
        }
        input[type="checkbox"],
        input[type="radio"] {
            box-sizing: border-box;
            padding: 0;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            height: auto;
        }
        input[type="search"] {
            -webkit-appearance: textfield;
        }
        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-decoration {
            -webkit-appearance: none;
        }
        fieldset {
            margin: 0 2px;
            padding: 0.35em 0.625em 0.75em;
            border: 1px solid #c0c0c0;
        }
        legend {
            padding: 0;
            border: 0;
        }
        textarea {
            overflow: auto;
        }
        optgroup {
            font-weight: bold;
        }
        table {
            border-spacing: 0;
            border-collapse: collapse;
        }
        td,
        th {
            padding: 0;
        }


        /* ==========================================================================
           1. General - Setting up some base styles
           ========================================================================== */

        html {
            max-height: 100%;
            height: 100%;
            font-size: 62.5%;

            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        body {
            max-height: 100%;
            height: 100%;
            color: #3a4145;
            background: #f4f8fb;
            letter-spacing: 0.01rem;
            font-family: "Merriweather", serif;
            font-size: 1.8rem;
            line-height: 1.75em;
            text-rendering: geometricPrecision;

            -webkit-font-feature-settings: "kern" 1;
            -moz-font-feature-settings: "kern" 1;
            -o-font-feature-settings: "kern" 1;
        }

        ::-moz-selection {
            background: #d6edff;
        }

        ::selection {
            background: #d6edff;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0 0 0.3em 0;
            color: #2e2e2e;
            font-family: "Open Sans", sans-serif;
            line-height: 1.15em;
            text-rendering: geometricPrecision;

            -webkit-font-feature-settings: "dlig" 1, "liga" 1, "lnum" 1, "kern" 1;
            -moz-font-feature-settings: "dlig" 1, "liga" 1, "lnum" 1, "kern" 1;
            -o-font-feature-settings: "dlig" 1, "liga" 1, "lnum" 1, "kern" 1;
        }

        h1 {
            text-indent: -2px;
            letter-spacing: -1px;
            font-size: 2.6rem;
        }

        h2 {
            letter-spacing: 0;
            font-size: 2.4rem;
        }

        h3 {
            letter-spacing: -0.6px;
            font-size: 2.1rem;
        }

        h4 {
            font-size: 1.9rem;
        }

        h5 {
            font-size: 1.8rem;
        }

        h6 {
            font-size: 1.8rem;
        }

        a {
            color: #4a4a4a;
        }

        a:hover {
            color: #111;
        }

        p,
        ul,
        ol,
        dl {
            margin: 0 0 2.5rem 0;
            font-size: 1.5rem;
            text-rendering: geometricPrecision;

            -webkit-font-feature-settings: "liga" 1, "onum" 1, "kern" 1;
            -moz-font-feature-settings: "liga" 1, "onum" 1, "kern" 1;
            -o-font-feature-settings: "liga" 1, "onum" 1, "kern" 1;
        }

        ol,
        ul {
            padding-left: 2em;
        }

        ol ol,
        ul ul,
        ul ol,
        ol ul {
            margin: 0 0 0.4em 0;
            padding-left: 2em;
        }

        dl dt {
            float: left;
            clear: left;
            overflow: hidden;
            margin-bottom: 1em;
            width: 180px;
            text-align: right;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 700;
        }

        dl dd {
            margin-bottom: 1em;
            margin-left: 200px;
        }

        li {
            margin: 0.4em 0;
        }

        li li {
            margin: 0;
        }

        hr {
            display: block;
            margin: 1.75em 0;
            padding: 0;
            height: 1px;
            border: 0;
            border-top: #efefef 1px solid;
        }

        blockquote {
            box-sizing: border-box;
            margin: 1.75em 0 1.75em 0;
            padding: 0 0 0 1.75em;
            border-left: #4a4a4a 0.4em solid;

            -moz-box-sizing: border-box;
        }

        blockquote p {
            margin: 0.8em 0;
            font-style: italic;
        }

        blockquote small {
            display: inline-block;
            margin: 0.8em 0 0.8em 1.5em;
            color: #ccc;
            font-size: 0.9em;
        }

        blockquote small:before {
            content: "\2014 \00A0";
        }

        blockquote cite {
            font-weight: 700;
        }

        blockquote cite a {
            font-weight: normal;
        }

        mark {
            background-color: #fdffb6;
        }

        code,
        tt {
            padding: 1px 3px;
            border: #e3edf3 1px solid;
            background: #f7fafb;
            border-radius: 2px;
            white-space: pre-wrap;
            font-family: Inconsolata, monospace, sans-serif;
            font-size: 0.85em;
            font-feature-settings: "liga" 0;

            -webkit-font-feature-settings: "liga" 0;
            -moz-font-feature-settings: "liga" 0;
        }

        pre {
            overflow: auto;
            box-sizing: border-box;
            margin: 0 0 1.75em 0;
            padding: 10px;
            width: 100%;
            border: #e3edf3 1px solid;
            background: #f7fafb;
            border-radius: 3px;
            white-space: pre;
            font-family: Inconsolata, monospace, sans-serif;
            font-size: 0.9em;

            -moz-box-sizing: border-box;
        }

        pre code,
        pre tt {
            padding: 0;
            border: none;
            background: transparent;
            white-space: pre-wrap;
            font-size: inherit;
        }

        kbd {
            display: inline-block;
            margin-bottom: 0.4em;
            padding: 1px 8px;
            border: #ccc 1px solid;
            background: #f4f4f4;
            border-radius: 4px;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2),
            0 1px 0 0 #fff inset;
            color: #666;
            text-shadow: #fff 0 1px 0;
            font-size: 0.9em;
            font-weight: 700;
        }

        table {
            box-sizing: border-box;
            margin: 1.75em 0;
            max-width: 100%;
            width: 100%;
            background-color: transparent;

            -moz-box-sizing: border-box;
        }

        table th,
        table td {
            padding: 8px;
            border-top: #efefef 1px solid;
            vertical-align: top;
            text-align: left;
            line-height: 20px;
        }

        table th {
            color: #000;
        }

        table caption + thead tr:first-child th,
        table caption + thead tr:first-child td,
        table colgroup + thead tr:first-child th,
        table colgroup + thead tr:first-child td,
        table thead:first-child tr:first-child th,
        table thead:first-child tr:first-child td {
            border-top: 0;
        }

        table tbody + tbody {
            border-top: #efefef 2px solid;
        }

        table table table {
            background-color: #fff;
        }

        table tbody > tr:nth-child(odd) > td,
        table tbody > tr:nth-child(odd) > th {
            background-color: #f6f6f6;
        }

        table.plain tbody > tr:nth-child(odd) > td,
        table.plain tbody > tr:nth-child(odd) > th {
            background: transparent;
        }

        iframe,
        amp-iframe,
        .fluid-width-video-wrapper {
            display: block;
            margin: 1.75em 0;
        }

        /* When a video is inside the fitvids wrapper, drop the
        margin on the iframe, cause it breaks stuff. */
        .fluid-width-video-wrapper iframe,
        .fluid-width-video-wrapper amp-iframe {
            margin: 0;
        }

        textarea,
        select,
        input {
            margin: 0 0 5px 0;
            padding: 6px 9px;
            width: 260px;
            outline: 0;
            border: #e7eef2 1px solid;
            background: #fff;
            border-radius: 4px;
            box-shadow: none;
            font-family: "Open Sans", sans-serif;
            font-size: 1.6rem;
            line-height: 1.4em;
            font-weight: 100;

            -webkit-appearance: none;
        }

        textarea {
            min-width: 250px;
            min-height: 80px;
            max-width: 340px;
            width: 100%;
            height: auto;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="search"]:focus,
        input[type="tel"]:focus,
        input[type="url"]:focus,
        input[type="password"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="month"]:focus,
        input[type="week"]:focus,
        input[type="time"]:focus,
        input[type="datetime"]:focus,
        input[type="datetime-local"]:focus,
        textarea:focus {
            outline: none;
            outline-width: 0;
            border: #bbc7cc 1px solid;
            background: #fff;
        }

        select {
            width: 270px;
            height: 30px;
            line-height: 30px;
        }

        /* ==========================================================================
           2. Utilities
           ========================================================================== */

        /* Clears shit */
        .clearfix:before,
        .clearfix:after {
            content: " ";
            display: table;
        }
        .clearfix:after {
            clear: both;
        }
        .clearfix {
            zoom: 1;
        }

        /* ==========================================================================
           3. AMP Post
           ========================================================================== */



        .main-header {
            position: relative;
            display: table;
            overflow: hidden;
            box-sizing: border-box;
            width: 100%;
            height: 50px;
            background: #5ba4e5 no-repeat center center;
            background-size: cover;
            text-align: left;

            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        .content {
            background: #fff;
            padding-top: 15px;
        }
        .blog-title,
        .content {
            margin: auto;
            max-width: 600px;
        }

        .blog-title a {
            display: block;
            padding-right: 16px;
            padding-left: 16px;
            height: 50px;
            color: #fff;
            text-decoration: none;
            font-family: "Open Sans", sans-serif;
            font-size: 16px;
            line-height: 50px;
            font-weight: 600;
        }

        .post {
            position: relative;
            margin-top: 0;
            margin-right: 16px;
            margin-left: 16px;
            padding-bottom: 0;
            max-width: 100%;
            border-bottom: #ebf2f6 1px solid;
            word-wrap: break-word;
            font-size: 0.95em;
            line-height: 1.65em;
        }

        .post-header {
            margin-bottom: 1rem;
        }

        .post-title {
            margin-bottom: 0;
        }

        .post-title a {
            text-decoration: none;
        }

        .post-meta {
            display: block;
            margin: 3px 0 0 0;
            color: #9eabb3;
            font-family: "Open Sans", sans-serif;
            font-size: 1.3rem;
            line-height: 2.2rem;
        }

        .post-meta a {
            color: #9eabb3;
            text-decoration: none;
        }

        .post-meta a:hover {
            text-decoration: underline;
        }

        .post-meta .author {
            margin: 0;
            font-size: 1.3rem;
            line-height: 1.3em;
        }

        .post-date {
            display: inline-block;
            text-transform: uppercase;
            white-space: nowrap;
            font-size: 1.2rem;
            line-height: 1.2em;
        }

        .post-image {
            margin: 0;
            padding-top: 3rem;
            padding-bottom: 30px;
            border-top: 1px #E8E8E8 solid;
        }

        /* Keep images centered, and allow images wider than the main
           text column to break out. */
        .post-content amp-img,
        .post-content amp-anim {
            /* Centers an image by (1) pushing its left edge to the
               center of its container and (2) shifting the entire image
               in the opposite direction by half its own width.
               Works for images that are larger than their containers. */
            position: relative;
            left: 50%;
            display: block;
            padding: 0;
            min-width: 0;
            max-width: 112%; /* fallback when calc doesn't work */
            width: calc(100% + 32px); /* expand with to image + margins */
            height: auto;
            transform: translateX(-50%);

            -webkit-transform: translateX(-50%); /* for Safari and iOS */
            -ms-transform: translateX(-50%); /* for IE9 */
        }

        .footnotes {
            font-size: 1.3rem;
            line-height: 1.6em;
            font-style: italic;
        }

        .footnotes li {
            margin: 0.6rem 0;
        }

        .footnotes p {
            margin: 0;
        }

        .footnotes p a:last-child {
            text-decoration: none;
        }

        /* ==========================================================================
           4. Footer - The bottom the AMP Post
           ========================================================================== */

        .site-footer {
            position: relative;
            margin: 0 auto 20px auto;
            padding: 1rem 15px;
            max-width: 600px;
            color: rgba(0,0,0,0.5);
            font-family: "Open Sans", sans-serif;
            font-size: 1.1rem;
            line-height: 1.75em;
        }

        .site-footer a {
            color: rgba(0,0,0,0.5);
            text-decoration: none;
            font-weight: bold;
        }

        .site-footer a:hover {
            border-bottom: #bbc7cc 1px solid;
        }

        .poweredby {
            display: block;
            float: right;
            width: 45%;
            text-align: right;
        }

        .copyright {
            display: block;
            float: left;
            width: 45%;
        }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../index.html">江矿宝宝的博客.</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Node.js(1) 封装,调用,执行,访问路径,http,函数编程,等待函数,事件监听</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../author/jkbb/index.html">江矿宝宝.</a></p>
                    <time class="post-date" datetime="2016-10-01">2016-10-01</time>
                </section>
            </header>
            <section class="post-content">

                <h3 id="1">1.如何封装一个模块；</h3>

首先，我们建立一个js文件，例如命名为test.js；
然后在里面写一个函数，函数名任意；
然后通过exports.变量名，将函数赋值给这个变量；
如代码：
  

<pre><code class="language-js">function test(){    //请注意这个函数名  
    console.log(&quot;1&quot;);
}
exports.testBegin= test;   //等号后面的test，指的是上面的函数名。等号前面的testBegin，是调用时的函数名（注意区别）  
</code></pre>

<p>这个test.js的文件就写完了，这是一个模块，他的效果是调用该函数后，输出1；
另外，不要问我这个exports是什么，我暂时也不知道。</p>

<h2 id="2">2.如何调用一个模块</h2>

<p>在封装模块的前提下，我们新建一个文件，例如a.js，来调用之前封装的test.js模块；
方法是：</p>

<pre><code class="language-js">var test = require(&quot;./test&quot;);   //调用该模块  
test.testBegin();   //调用该模块的方法（注意方法名是test.js中exports后面的变量名）；  
</code></pre>

<p>注意调用时的方法名，并非是test.js中的函数名test；</p>

<h3 id="3nodejs">3.如何执行一个Node.js的文件</h3>

<p>我们现在需要执行a.js这个调用了封装模块的文件了，执行他的方法，和执行普通的node.js的文件的方法并没有什么不同；
在a.js这个文件的目录下，打开命令行。windows是shift＋鼠标右键；
像下面这样输入即可：
然后将输出1，感觉执行执行Python文件那样</p>

<h3 id="4">4.获得访问者想要访问的路径</h3>

<p><amp-img src="http://img.blog.csdn.net/20160602214711294" alt width="431" height="355" layout="responsive"></amp-img>
首先上图，其中pathname指的是路径；而query指的是请求之类的东西（暂时不关心）；
假如我们想要获得pathname（即字符串“start”），我们该怎么办呢？
方法：
* ①首先，需要获取访问者需要访问的路径，方法是通过http的方法createServer
具体来说：
我们先require一个http模块：</p>

<pre><code class="language-js">var http = require(&quot;http&quot;);  
</code></pre>

<p>然后调用其方法，创建一个服务器：</p>

<pre><code class="language-js">http.createServer(onRequest).listen(8888);  
</code></pre>

<p>注意，这个方法监听的是8888端口，其参数是一个函数；</p>

<p>然后我们书写这个函数的内容：</p>

<pre><code class="language-js">function onRequest(request, response) {  
    console.log(request.url);
}
</code></pre>

<p>这个函数的第一个参数request是用户访问的一些东西，我们需要的是其url变量；假设我们访问地址是这样的：
<code>http://127.0.0.1:8888/index/loading?start</code>
请注意红色部分，那么服务器在console.log输出的是</p>

<pre><code>/index/loading?start
</code></pre>

<ul>
<li>②我们下来要对这个url做点什么了；
虽然直接对上面那个参数进行操纵也可以，但这太笨了，让我们来require一个新的模块url</li>
</ul>

<pre><code class="language-js">var url = require(&quot;url&quot;);  
</code></pre>

<ul>
<li>③调用这个新模块的方法parse，将第一步获得的url地址，作为其参数，再调用其方法pathname，就可以获得我们想要的东西了；
具体而言，需要这么一段代码：</li>
</ul>

<pre><code class="language-js">var pathname = url.parse(request.url).pathname;  
</code></pre>

<p>这个pathname就是我们需要的东西了；</p>

<p>把所有代码综合起来，是这样的：</p>

<pre><code class="language-js">var http = require(&quot;http&quot;);  
var url = require(&quot;url&quot;);  
function onRequest(request, response) {  
    var pathname = url.parse(request.url).pathname;
    console.log(&quot;Request for &quot; + pathname + &quot; recived.&quot;);
    response.writeHead(200, {&quot;Content-type&quot;: &quot;text/plain&quot;});
    response.write(&quot;Hello word!&quot;);
    response.end();
}
http.createServer(onRequest).listen(8888);  
console.log(&quot;Server has started!&quot;);  
</code></pre>

<p>然后运行之：</p>

<p>我们随便访问一个本地的地址：
<code>http://127.0.0.1:8888/index/loading?start</code></p>

<p>发现，/index/loding这部分被正常的显示出来了。
另外，favicon.ico是该网站的图标，据说很多服务器是会默认读取的；</p>

<p>假如我们直接访问：<code>http://127.0.0.1:8888</code>，显示是这样的
<amp-img src="http://img.blog.csdn.net/20160602214745169" alt width="291" height="38" layout="fixed"></amp-img></p>

<h3 id="5http">5.关于http</h3>

<p>我们之前有了这么一段代码（已delete掉无关部分）：</p>

<pre><code class="language-js">var http = require(&quot;http&quot;);  
function onRequest(request, response) {  
    response.writeHead(200, {&quot;Content-type&quot;: &quot;text/plain&quot;});
    response.write(&quot;Hello word!&quot;);
    response.end();
}
http.createServer(onRequest).listen(8888);  
</code></pre>

<p>其中，http调用了NodeJs自带的一个模块“http”，而这个模块是一个服务器模块；
而createServer是这个模块的方法，效果是返回一个对象，而这个对象有一个listen的方法；
当然，由于你和我，也许都是新手，因此我们尚没有搞清楚这个到底是怎么运作的；但如果有一定经验的话，可以猜到，这个listen是监听，监听的是8888端口；如果去掉这部分会怎么样？经过测试，服务器并没有运行，如图：</p>

<p>而onRequest函数呢，从名字可以猜到，这个函数的效果是“当请求的时候做些什么”，我们来看其函数：</p>

<pre><code class="language-js">function onRequest(request, response) {  
    response.writeHead(200);
    response.write(&quot;Hello word!&quot;);
    response.end();
}
</code></pre>

<p>这个函数有两个参数：request和response，顾名思义，请求和响应。
request请求指用户访问的时候，相关的信息； <br></br>
response指服务器的响应，会做些什么；这个函数的三个方法，都是response相关的；</p>

<ul>
<li><p>第一个：response.writeHead方法，具体来说，就是HTTP响应报文的头行；
这个指HTTP通信的响应报文中的头部分，如果没有基础的话，暂时不需要关心，写200即可，这里的200，是约定俗称的请求成功时的返回；
具体搜：
<code>response.writeHead(statusCode,[reasonPhrase], [headers])</code></p></li>
<li><p>第二个：response.write方法，具体来说，是HTTP响应报文；
简单理解，负责发送正文中的一部分，可以同时发送多个不一样的；
在上面搜：
<code>response.write(chunk,encoding='utf8')</code></p></li>
<li><p>第三个：response.end方法，具体来说每一个响应的结束，必须要调用这个方法，然后服务器会认为这条信息已经发送完毕了。</p></li>
</ul>

<p>综合效果来说，当我们访问：<code>http://127.0.0.1:8888/</code>时，浏览器会出现：
<code>Hello world!</code></p>

<h3 id="6">6.函数式编程</h3>

<p>所谓函数式编程，简单的理解，就是将函数作为参数传递；
目前有四个文件：
<code>index.js</code></p>

<pre><code class="language-js">var server = require(&quot;./server&quot;);   //调用该模块  
var router = require(&quot;./router&quot;);  
var requestHandlers = require(&quot;./requestHandlers&quot;);

var handle = {};  
handle[&quot;/&quot;] = requestHandlers.start;  
handle[&quot;/start&quot;] = requestHandlers.start;  
handle[&quot;/upload&quot;] = requestHandlers.upload;

server.start(router.route, handle);   //调用该模块的方法（注意方法名是test.js中exports后面的变量名）  
</code></pre>

<p><code>server.js</code></p>

<pre><code class="language-js">var http = require(&quot;http&quot;);  
var url = require(&quot;url&quot;);  
function start(route, handle) {  
    var count = 0;

    function onRequest(request, response) {
        console.log(count++ + &quot;#:&quot;);
        var pathname = url.parse(request.url).pathname;
        console.log(&quot;Request for &quot; + pathname + &quot; recived.&quot;);

        route(handle, pathname);    //来源于上面的start的参数

        response.writeHead(200);
        response.write(&quot;Hello word!&quot;);
        response.end();
    }

    http.createServer(onRequest).listen(8888);
    console.log(&quot;Server has started!&quot;);
}
exports.start = start;  
</code></pre>

<p><code>router.js</code></p>

<pre><code class="language-js">function route(handle, pathname) {  
    console.log(&quot;About to route a request for &quot; + pathname);
    if (typeof handle[pathname] === 'function') {
        handle[pathname]();
    } else {
        console.log(&quot;No request handler found for &quot; + pathname);
    }
}

exports.route = route;  
</code></pre>

<p><code>requestHandler.js</code></p>

<pre><code class="language-js">function start() {  
    console.log(&quot;Request handler 'start' was called&quot;);
}

function upload() {  
    console.log(&quot;Request handler 'upload' was called&quot;);
}

exports.start = start;  
exports.upload = upload;  
</code></pre>

<p>分析：
* ①首先看index.js，他调用了3个模块，然后声明了一个空的对象，然后给这个对象声明了几个不同的变量（准确的说是函数变量），他们分别对应requestHandlers这个模块的不同函数；</p>

<p>调用server这个模块的start方法，传两个参数，分别是router模块的route方法和对象handle（包含3个函数变量）；</p>

<ul>
<li>②由于调用了server模块的start方法，因此我们来看server模块；
在server模块中，调用了两个模块，分别是http和url，这两个都是NodeJs自带的，具体里面的内容就不一一分析了（前面已经说明过了）。</li>
</ul>

<p>在servre模块的start函数（也是index.js调用的方法），有两个参数，第一个参数是route函数（来源于router模块），第二个参数是一个对象（来源于index.js）。</p>

<p>而在start函数中，调用了其第一个参数（route函数），由于这个参数是函数，因此运行它，给其两个参数，分别是handle（来源于index.js的对象）和pathname（来源于当前模块，是用户请求的路径）；</p>

<p>因此接下来我们看router模块的route函数，记得，这个函数传递了一个对象和一个路径；</p>

<ul>
<li>③在router模块中，传递了两个参数，并进行了一次判断；
判断的逻辑是这样的，第一个参数（是一个对象），其加上下标后的值，如果是类型是函数，那么执行这个函数；如果不是函数，提示没找到该句柄；</li>
</ul>

<p>请注意，为什么说这个对象加上下标是函数呢，原因在于index中声明的这个对象，而这个对象的三个带下标的变量都是函数；</p>

<p>而这三个被执行函数来源于哪呢？来源于index里加载的模块requestHandlers，那么最后让我们来看看这个模块；</p>

<ul>
<li>④在这个模块里，只有两个函数，分别是start和upload；
这两个函数输出不同的内容（一个关键字是start，另一个关键字是upload）；
请回想之前的下标，下标分为三个，分别是空（/），start下标（/start），和upload下标（/upload），因此当用户访问根目录、start目录、和upload目录时，调用对应的方法，而若访问其他目录（包括start目录的子目录等时，提示错误——来源于router模块）；
<amp-img src="http://img.blog.csdn.net/20160602214830419" alt width="315" height="291" layout="responsive"></amp-img>
现在回顾这种模式是怎么实现的：
<amp-img src="http://img.blog.csdn.net/20160602214835576" alt width="580" height="408" layout="responsive"></amp-img></li>
</ul>

<h3 id="7">7.等待函数</h3>

<pre><code class="language-js">function sleep(milliSeconds) {  
    var startTime = new Date().getTime();
    while (new Date() &lt; startTime + milliSeconds);  //等待参数的时间
}
</code></pre>

<p>传的参数是毫秒，在这个时间前，无法执行下一句代码，类似C++的Sleep()函数</p>

<h3 id="8">8.返回的两种格式</h3>

<pre><code class="language-js">response.writeHead(200, {&quot;Content-Type&quot;: &quot;text/html&quot;});  
response.write(content);  
response.end();  
</code></pre>

<p>其中，writeHead里面的第二个参数，有多种格式，分别是：
application/xml 、 text/xml、text/html、text/plain <br></br>
经查：
text/html是html格式的正文 <br></br>
text/plain是无格式正文 <br></br>
text/xml忽略xml头所指定编码格式而默认采用us-ascii编码 <br></br>
application/xml会根据xml头指定的编码格式来编码： <br></br>
简单来说，html就是返回一个html，plain就是无格式的，写什么就是什么，xml就是一个xml文件；</p>

<h3 id="9">9.关于事件监听</h3>

<p>之前说到有</p>

<pre><code class="language-js">function onRequest(request, response)  
</code></pre>

<p>这样一个回调函数，其中request是请求，response是回应；
根据推测，每次request的，都会触发至少一个data，一个end事件，因此应该监听这两个事件。（并且只有接受到data之后，才会接收到end事件）；
我们之前是不监听的，只要有请求，就直接执行某个函数，而监听表示只有这些事件触发后，我们才会执行某一段代码。
因此我们这么写：</p>

<pre><code class="language-js">var postData = &quot;&quot;;  
request.setEncoding(&quot;utf8&quot;);  
request.addListener(&quot;data&quot;, function (postDataChunk) {      //data事件  
    postData += postDataChunk;
    console.log(&quot;Received POST data chunk &quot; + postDataChunk + &quot;.&quot;);
    console.log(&quot;————————&quot;);
})
request.addListener(&quot;end&quot;, function () {  
    route(handle, pathname, response, postData);
})
</code></pre>

<p>表示监听的编码类型为UTF8，监听data事件，把内容加起来，监听end事件，把加起来的内容发送出去。
直到end事件触发时，才会执行之前写的route函数（也就是那个写回复的函数）。</p>

<p>PS： <br></br>
根据我的测试，如果data事件注释掉，end事件会无法执行，准确的说，是无法访问任何url的。
但是，如果不注释掉，只是普通的访问的话，可是又不会触发data监听事件里面的console.log代码，很奇怪； 
另外，注释掉end事件，留着data事件，也会卡住； </p>

            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../index.html">江矿宝宝的博客.</a> &copy; 2017</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
</html>
