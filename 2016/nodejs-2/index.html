<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Node.js(2) MySQL | 江矿宝宝的博客.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="MySQL是mysql-5.6.17nodejs是目前最新版。
①安装nodejs的mysql模块如果你的nodejs的版本比较新的话，应该不存在安装路径问题；在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）；输入：">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js(2) MySQL">
<meta property="og:url" content="http://joname1.github.io/2016/nodejs-2/index.html">
<meta property="og:site_name" content="江矿宝宝的博客.">
<meta property="og:description" content="MySQL是mysql-5.6.17nodejs是目前最新版。
①安装nodejs的mysql模块如果你的nodejs的版本比较新的话，应该不存在安装路径问题；在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）；输入：">
<meta property="og:image" content="http://p1.bpimg.com/567571/8a56c4679605be87.png">
<meta property="og:image" content="http://p1.bpimg.com/567571/e7ee7e55bcf03dd5.png">
<meta property="og:image" content="http://p1.bpimg.com/567571/76a59ac469b33b45.png">
<meta property="og:image" content="http://img.blog.csdn.net/20160612152004210">
<meta property="og:image" content="http://img.blog.csdn.net/20160612152125384">
<meta property="og:image" content="http://img.blog.csdn.net/20160612152225291">
<meta property="og:image" content="http://img.blog.csdn.net/20160612152323055">
<meta property="og:image" content="http://img.blog.csdn.net/20160612152440545">
<meta property="og:image" content="http://img.blog.csdn.net/20160612152611657">
<meta property="og:image" content="http://img.blog.csdn.net/20160612153243840">
<meta property="og:image" content="http://img.blog.csdn.net/20160612153302712">
<meta property="og:updated_time" content="2016-10-19T08:48:40.110Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node.js(2) MySQL">
<meta name="twitter:description" content="MySQL是mysql-5.6.17nodejs是目前最新版。
①安装nodejs的mysql模块如果你的nodejs的版本比较新的话，应该不存在安装路径问题；在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）；输入：">
<meta name="twitter:image" content="http://p1.bpimg.com/567571/8a56c4679605be87.png">
  
  
  <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://joe-10005639.file.myqcloud.com/jkbb.jpg" class="js-avatar show">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Joname</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Just be nice, always think twice!</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
						<ul class="tips-inner">
						    <li>菜单</li>
						    <li>标签</li>
						    
						    
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/joname1" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/joname-liangtan" title="zhihu">zhihu</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/im_joname" title="twitter">twitter</a>
					        
								<a class="mail" target="_blank" href="mailto:joname.liangtan@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Bootstrap/" style="font-size: 10px;">Bootstrap</a> <a href="/tags/Shadowsocks/" style="font-size: 13.33px;">Shadowsocks</a> <a href="/tags/angular-js/" style="font-size: 10px;">angular.js</a> <a href="/tags/angularjs/" style="font-size: 10px;">angularjs</a> <a href="/tags/browser-sync/" style="font-size: 10px;">browser-sync</a> <a href="/tags/commonjs/" style="font-size: 10px;">commonjs</a> <a href="/tags/css/" style="font-size: 13.33px;">css</a> <a href="/tags/es6/" style="font-size: 11.67px;">es6</a> <a href="/tags/fuck-gfw/" style="font-size: 15px;">fuck-gfw</a> <a href="/tags/grid/" style="font-size: 10px;">grid</a> <a href="/tags/gulp/" style="font-size: 20px;">gulp</a> <a href="/tags/hiwifi/" style="font-size: 10px;">hiwifi</a> <a href="/tags/hosts/" style="font-size: 10px;">hosts</a> <a href="/tags/javaScript/" style="font-size: 10px;">javaScript</a> <a href="/tags/javascript/" style="font-size: 16.67px;">javascript</a> <a href="/tags/js/" style="font-size: 13.33px;">js</a> <a href="/tags/less/" style="font-size: 11.67px;">less</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/node-js/" style="font-size: 16.67px;">node.js</a> <a href="/tags/nodejs/" style="font-size: 18.33px;">nodejs</a> <a href="/tags/qiniu/" style="font-size: 10px;">qiniu</a> <a href="/tags/requirejs/" style="font-size: 15px;">requirejs</a> <a href="/tags/sass/" style="font-size: 10px;">sass</a> <a href="/tags/sprite/" style="font-size: 10px;">sprite</a> <a href="/tags/ss/" style="font-size: 13.33px;">ss</a> <a href="/tags/surge/" style="font-size: 10px;">surge</a> <a href="/tags/webpack/" style="font-size: 13.33px;">webpack</a> <a href="/tags/yarn/" style="font-size: 10px;">yarn</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Joname</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://joe-10005639.file.myqcloud.com/jkbb.jpg" class="js-avatar show">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Joname</h1>
			</hgroup>
			
			<p class="header-subtitle">Just be nice, always think twice!</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/joname1" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/joname-liangtan" title="zhihu">zhihu</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/im_joname" title="twitter">twitter</a>
			        
						<a class="mail" target="_blank" href="mailto:joname.liangtan@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-nodejs-2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/nodejs-2/" class="article-date">
  	<time datetime="2016-10-02T08:22:52.000Z" itemprop="datePublished">Oct 2</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Node.js(2) MySQL
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>MySQL是mysql-5.6.17<br>nodejs是目前最新版。</p>
<h1 id="①安装nodejs的mysql模块"><a href="#①安装nodejs的mysql模块" class="headerlink" title="①安装nodejs的mysql模块"></a>①安装nodejs的mysql模块</h1><p>如果你的nodejs的版本比较新的话，应该不存在安装路径问题；<br>在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）；<br>输入：<br><a id="more"></a><br><code>npm install mysql</code></p>
<p>正常的话，应该出的是一个带树形结构的图，比如这样：<br><img src="http://p1.bpimg.com/567571/8a56c4679605be87.png" alt=""></p>
<p>如果差别过大，可能是出问题了，那么新建一个js文件，把以下内容复制粘贴进去<br>注意修改mysql的账号名、密码，而端口号3306是默认的；<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql  = <span class="built_in">require</span>(<span class="string">'mysql'</span>);  <span class="comment">//调用MySQL模块  </span></div><div class="line">  </div><div class="line"><span class="comment">//创建一个connection  </span></div><div class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;  </div><div class="line">    <span class="attr">host</span>     : <span class="string">'127.0.0.1'</span>,       <span class="comment">//主机  </span></div><div class="line">    user     : <span class="string">'root'</span>,               <span class="comment">//MySQL认证用户名  </span></div><div class="line">    password : <span class="string">''</span>,        <span class="comment">//MySQL认证用户密码  </span></div><div class="line">    port: <span class="string">'3306'</span>,                   <span class="comment">//端口号  </span></div><div class="line">&#125;);  </div><div class="line"><span class="comment">//创建一个connection  </span></div><div class="line">connection.connect(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;  </div><div class="line">    <span class="keyword">if</span>(err)&#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span>+err);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'[connection connect]  succeed!'</span>);  </div><div class="line">&#125;);  </div><div class="line"><span class="comment">//执行SQL语句  </span></div><div class="line">connection.query(<span class="string">'SELECT 1 + 1 AS solution'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, rows, fields</span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (err) &#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span>+err);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, rows[<span class="number">0</span>].solution);  </div><div class="line">&#125;);  </div><div class="line"><span class="comment">//关闭connection  </span></div><div class="line">connection.end(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;  </div><div class="line">    <span class="keyword">if</span>(err)&#123;  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'[connection end] succeed!'</span>);  </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果正常运行的话，可以从控制台console.log出来的消息确认（具体请看代码）；</p>
<h1 id="②mysql的增add："><a href="#②mysql的增add：" class="headerlink" title="②mysql的增add："></a>②mysql的增add：</h1><p>假如我想在mysql里，数据库（database）名为test，表名为a_test_table插入数据。<br>假设你只装了mysql，却不懂mysql，那么这里我推荐你安装mysql-5.6.17-winx64这个版本，这样可以保证代码正常执行。<br>然后进入mysql，默认账号名为root，默认密码为空；<br>【以下代码注意结尾的分号，分号表示一条命令的结束】</p>
<p>输入showdatabases;<br>可以查看库名。应该有一个test库，如下图：<br><img src="http://p1.bpimg.com/567571/e7ee7e55bcf03dd5.png" alt=""><br>如果没有的话，请自行搜索如何创建一个库；<br>然后输入usetest;<br>进入test表；然后输入show tables;<br>显示test库下面的所有表，如下图：<br><img src="http://p1.bpimg.com/567571/76a59ac469b33b45.png" alt=""></p>
<p>当然，正常来说，你这里应该是空。于是我们需要建表，为了方便，建一个最简单的表，输入以下命令：<br>create table a_test_table(<br>id int,<br>name varchar(20));<br>创建一个表，他只有两个字段，分别是id（int类型表示数字），name（字符类型）。此时再打show tables;  便可以看到a_test_table这个表了；<br>再输入elect* from a_test_table;<br>查询表内容，会显示空：<br><img src="http://img.blog.csdn.net/20160612152004210" alt=""></p>
<p>下来开始正文，如何在这个表里插入内容：<br>首先，新建一个js文件，记得使用utf-8格式。<br>下面是代码，具体请看注释：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);  <span class="comment">//调用MySQL模块  </span></div><div class="line">  </div><div class="line"><span class="comment">//创建一个connection  </span></div><div class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;  </div><div class="line">    <span class="attr">host</span>: <span class="string">'127.0.0.1'</span>,       <span class="comment">//主机地址  </span></div><div class="line">    user: <span class="string">'root'</span>,               <span class="comment">//MySQL认证用户名  </span></div><div class="line">    password: <span class="string">''</span>,        <span class="comment">//MySQL认证用户密码  </span></div><div class="line">    port: <span class="string">'3306'</span>,                   <span class="comment">//端口号  </span></div><div class="line">    database: <span class="string">'test'</span>,                <span class="comment">//库名  </span></div><div class="line">&#125;);  </div><div class="line"><span class="comment">//创建一个connection，即连接到mysql的对象，如果连接错误，会提示错误。  </span></div><div class="line">connection.connect(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (err) &#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span> + err);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'[connection connect]  succeed!'</span>);  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="keyword">var</span> userAddSql = <span class="string">'INSERT INTO a_test_table(id, name) VALUES(?,?)'</span>;  </div><div class="line"><span class="comment">/* </span></div><div class="line">这里实际上是一个mysql语句， </div><div class="line">关键是第三个a_table_test表示表名； </div><div class="line">id和name表示字段名； </div><div class="line">两个问号表示插入的值，如果不是问号，而是一个值，那么表示这个字段固定插入这个值 </div><div class="line">*/  </div><div class="line"><span class="keyword">var</span> userAddSql_value = [<span class="number">1</span>, <span class="string">'wddddd'</span>];       <span class="comment">//这里实际依次对应的是上面2个问号，因为id是int，所以第一个是数字，第二个是字符串  </span></div><div class="line">  </div><div class="line">connection.query(userAddSql, userAddSql_value, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (err) &#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[INSERT ERROR] - '</span>, err.message);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'——————————————INSERT————————————————'</span>);  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'INSERT ID: '</span>, result);  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'—————————————————————————————————'</span>);  </div><div class="line">&#125;)  </div><div class="line">  </div><div class="line"><span class="comment">//关闭connection  </span></div><div class="line">connection.end(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (err) &#123;  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'[connection end] succeed!'</span>);  </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果显示错误，请检查自己的nodejs代码，一般问题常发生在账号名、密码、库名、表名等。</p>
<h1 id="③查select："><a href="#③查select：" class="headerlink" title="③查select："></a>③查select：</h1><p>有没有发现代码的特点，他的关键是mysql的命令，只要我们更改命令，完全可以像直接在mysql里输入命令行一样操控mysql，例如，我们只需要改这么一段代码：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> userAddSql = <span class="string">'SELECT * FORM a_test_table'</span>;</div></pre></td></tr></table></figure></p>
<p>即使完全不动其他代码，那么回调函数也能正常运行，其表现应该是这样：<br><img src="http://img.blog.csdn.net/20160612152125384" alt=""><br>当然，完全不改是不好的，但无论如何，我们需要的功能是实现了。<br>另外，显而易见，我们需要对返回内容进行操纵，那么首先我们需要明确返回内容是什么？结论是，他是一个数组（从 [] 可以猜出），然后我们这个数组只有一项，因此加上下标[0]，假如我们需要获取name属性，那么就是result[0].name；<br>总得来说，代码在之前的基础上这么修改：<br>把<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="string">'INSERT ID: '</span>, result);</div></pre></td></tr></table></figure></p>
<p>修改为：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(result[<span class="number">0</span>].name);</div></pre></td></tr></table></figure></p>
<p>然后再次执行js文件，显示结果应该是这样：<br><img src="http://img.blog.csdn.net/20160612152225291" alt=""></p>
<h1 id="④删delete"><a href="#④删delete" class="headerlink" title="④删delete"></a>④删delete</h1><p>是不是感觉很简单，让我们Go on<br>这次我们要删除id=1的那一项（因为id是唯一的，不会删错）——虽然我们其实就一项<br>在之前代码上继续修改：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> userAddSql = <span class="string">'DELETE FROM a_test_table WHERE id = 1'</span>;  <span class="comment">//之所以大写mysql的指令，是为了和数据区分，事实上不大写也是可以的</span></div></pre></td></tr></table></figure></p>
<p>然后执行之；<br>毫无疑问，代码会报错，但是并非我们删除命令错误了，而是因为之前的代码，会输出结果的name属性，显然咯，都被删除了，哪有name属性；<br>为了证明我们删除命令并没错，在mysql里进行查询：<br><img src="http://img.blog.csdn.net/20160612152323055" alt=""><br>我们可以发现，我们需要删除的那一项被删除了。</p>
<h1 id="⑤改update"><a href="#⑤改update" class="headerlink" title="⑤改update"></a>⑤改update</h1><p>增删查改，我们只剩下改了。但是目前mysql表里没内容，我们需要重新加上一些mysql信息。<br>一次插入多条数据：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> userAddSql_value = [[<span class="number">1</span>, <span class="string">'a'</span>], [<span class="number">2</span>, <span class="string">'d'</span>]];  </div><div class="line">  </div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; userAddSql_value.length; i++) &#123;  </div><div class="line">    connection.query(userAddSql, userAddSql_value[i], <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (err) &#123;  </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'[INSERT ERROR] - '</span>, err.message);  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'——————————————INSERT————————————————'</span>);  </div><div class="line">        <span class="built_in">console</span>.log(result[<span class="number">0</span>].name);  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'—————————————————————————————————'</span>);  </div><div class="line">    &#125;)  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后接下来，我们要修改数据了。<br>我们这次的目的，是把id=1的项，name修改为pp<br>需要注意的是，所有id=1的项，name属性都将被修改为pp（而不是仅仅只有一个）；<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> userAddSql = <span class="string">'UPDATE a_test_table SET name = ? WHERE id = ?'</span>;    </div><div class="line"><span class="keyword">var</span> userAddSql_value = [<span class="string">"pp"</span>, <span class="number">1</span>];   </div><div class="line">connection.query(userAddSql, userAddSql_value, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (err) &#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[INSERT ERROR] - '</span>, err.message);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'——————————————INSERT————————————————'</span>);  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'INSERT ID: '</span>, result);  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'—————————————————————————————————'</span>);  </div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>运行之，然后再查表，正常的话，你会发现，id=1的项，其值被更为为了pp<br><img src="http://img.blog.csdn.net/20160612152440545" alt=""></p>
<h1 id="⑥断线重连"><a href="#⑥断线重连" class="headerlink" title="⑥断线重连"></a>⑥断线重连</h1><p>按照说明，使用连接池的方法更好，不过既然看到了断线重连，虽然挺迷茫，但正常运行了（虽然并不明白，而且感觉有点出入），那就先用着<br>代码这么写：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);  <span class="comment">//调用MySQL模块  </span></div><div class="line">  </div><div class="line"><span class="comment">//创建一个connection  </span></div><div class="line"><span class="keyword">var</span> db_config = mysql.createConnection(&#123;  </div><div class="line">    <span class="attr">host</span>: <span class="string">'127.0.0.1'</span>,       <span class="comment">//主机地址  </span></div><div class="line">    user: <span class="string">'root'</span>,               <span class="comment">//MySQL认证用户名  </span></div><div class="line">    password: <span class="string">''</span>,        <span class="comment">//MySQL认证用户密码  </span></div><div class="line">    port: <span class="string">'3306'</span>,                   <span class="comment">//端口号  </span></div><div class="line">    database: <span class="string">'test'</span>,                <span class="comment">//库名  </span></div><div class="line">&#125;);  </div><div class="line"><span class="keyword">var</span> connect;  </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleDisconnect</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">    connect = mysql.createConnection(db_config);    <span class="comment">//创建连接（连接的设置是上面）  </span></div><div class="line">    connect.connect(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;    <span class="comment">//大概是指连接，  </span></div><div class="line">        <span class="keyword">if</span> (err) &#123;  </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"正在连接中："</span> + <span class="keyword">new</span> <span class="built_in">Date</span>());  </div><div class="line">            setTimeout(handleDisconnect, <span class="number">3000</span>);  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"连接成功"</span>);  </div><div class="line">        run();  </div><div class="line">    &#125;)  </div><div class="line">    connect.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'db error'</span>, err);  </div><div class="line">        <span class="keyword">if</span> (err.code === <span class="string">'PROTOCOL_CONNECTION_SET'</span>) &#123;  </div><div class="line">            handleDisconnect();  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="keyword">throw</span> err;  </div><div class="line">        &#125;  </div><div class="line">    &#125;)  </div><div class="line">&#125;  </div><div class="line">handleDisconnect();  </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">    db_config.connect(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (err) &#123;  </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span> + err);  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[connection connect]  succeed!'</span>);  </div><div class="line">    &#125;);  </div><div class="line">  </div><div class="line">    <span class="keyword">var</span> userAddSql = <span class="string">'UPDATE a_test_table SET name = ? WHERE id = ?'</span>;  </div><div class="line">    <span class="keyword">var</span> userAddSql_value = [<span class="string">"www"</span>, <span class="number">1</span>];  </div><div class="line">  </div><div class="line">    db_config.query(userAddSql, userAddSql_value, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (err) &#123;  </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'[INSERT ERROR] - '</span>, err.message);  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'——————————————INSERT————————————————'</span>);  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'INSERT ID: '</span>, result);  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'—————————————————————————————————'</span>);  </div><div class="line">    &#125;)  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="comment">//关闭connection  </span></div><div class="line">    db_config.end(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (err) &#123;  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[connection end] succeed!'</span>);  </div><div class="line">    &#125;);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="⑦连接池："><a href="#⑦连接池：" class="headerlink" title="⑦连接池："></a>⑦连接池：</h1><p>然后我试了试连接池的方法：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);  </div><div class="line"><span class="keyword">var</span> pool = mysql.createPool(&#123;  </div><div class="line">    <span class="attr">host</span>: <span class="string">'localhost'</span>,  </div><div class="line">    <span class="attr">user</span>: <span class="string">'root'</span>,  </div><div class="line">    <span class="attr">password</span>: <span class="string">''</span>,  </div><div class="line">    <span class="attr">database</span>: <span class="string">'test'</span>,  </div><div class="line">    <span class="attr">debug</span>: <span class="literal">false</span>,  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="keyword">var</span> insert = <span class="function"><span class="keyword">function</span> (<span class="params">connection, data</span>) </span>&#123;  </div><div class="line">    connection.query(<span class="string">'INSERT INTO a_test_table SET ?'</span>, data, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'ID : '</span> + result.insertId);  </div><div class="line">    &#125;);  </div><div class="line">&#125;;  </div><div class="line">  </div><div class="line"><span class="keyword">var</span> update = <span class="function"><span class="keyword">function</span> (<span class="params">connection, data</span>) </span>&#123;  </div><div class="line">    connection.query(<span class="string">'UPDATE a_test_table SET name = ? WHERE id = ?'</span>, data, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">    &#125;);  </div><div class="line">&#125;;  </div><div class="line">  </div><div class="line"><span class="keyword">var</span> select = <span class="function"><span class="keyword">function</span> (<span class="params">connection</span>) </span>&#123;  </div><div class="line">    connection.query(<span class="string">'SELECT * FROM a_test_table'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;  </div><div class="line">        result.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">user</span>) </span>&#123;  </div><div class="line">            <span class="built_in">console</span>.log(user.id + <span class="string">':'</span> + user.name + <span class="string">':'</span>);  </div><div class="line">        &#125;);  </div><div class="line">    &#125;);  </div><div class="line">&#125;;  </div><div class="line">  </div><div class="line">pool.getConnection(<span class="function"><span class="keyword">function</span> (<span class="params">err, connection</span>) </span>&#123;  </div><div class="line">    <span class="keyword">var</span> data = [<span class="string">'www'</span>, <span class="number">1</span>];  </div><div class="line">    select(connection);  </div><div class="line">    update(connection, data);  </div><div class="line">    select(connection);  </div><div class="line">&#125;);  </div><div class="line">  </div><div class="line"><span class="built_in">console</span>.log(<span class="string">'mysql is start!'</span>);  </div><div class="line"><span class="string">``</span><span class="string">` </span></div><div class="line">然后我尝试停用了mysql，运行这段代码，发现，停用后无法连接，并报错；如果是正在连接，那么会自动断掉连接。</div><div class="line"> </div><div class="line">不是很明白如何断线重连。</div><div class="line"> </div><div class="line">也许是假如断线了，就运行这个pool.getConnection这句代码？</div><div class="line">但是如何判断呢？不清楚</div><div class="line"> </div><div class="line">像下面这么写么？假如没连上，的确可以尝试重复连接，但是如果连接上的时候，断掉了，却不会继续重连。</div><div class="line">`<span class="string">``</span>js</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">toConnet</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">    pool.getConnection(<span class="function"><span class="keyword">function</span> (<span class="params">err, connection</span>) </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (err) &#123;  </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"连接中："</span> + err);  </div><div class="line">            setTimeout(toConnet, <span class="number">2000</span>);  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="keyword">var</span> data = [<span class="string">'bbbb'</span>, <span class="number">1</span>];  </div><div class="line">            select(connection);  </div><div class="line">            update(connection, data);  </div><div class="line">            select(connection);  </div><div class="line">        &#125;  </div><div class="line">    &#125;)  </div><div class="line">&#125;  </div><div class="line">toConnet();</div></pre></td></tr></table></figure></p>
<p>下面的表示链接成功了<br><img src="http://img.blog.csdn.net/20160612152611657" alt=""></p>
<h1 id="⑧防止SQL注入："><a href="#⑧防止SQL注入：" class="headerlink" title="⑧防止SQL注入："></a>⑧防止SQL注入：</h1><p>使用方法：escape()<br>具体用法是：<br>不过貌似nodejs本身就带有一定的防注入功能。例如，我把data改为：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> data = [<span class="string">"'bbbb', id = 2"</span>, <span class="number">1</span>];</div></pre></td></tr></table></figure></p>
<p>这样拼接出来的sql代码应该是：<br>UPDATE a_test_table SET name = ‘bbbb’, id = 2 WHERE id = 1<br>运行这个js文件后，会发现结果变成这样：<br><img src="http://img.blog.csdn.net/20160612153243840" alt=""><br>但若在mysql里面运行这段代码：<br>结果变成这样：<br><img src="http://img.blog.csdn.net/20160612153302712" alt=""><br>说明我们拼接的代码是没错的，只是mysql防止了这种简单的sql注入攻击。</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/requirejs-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          RequireJS入门(一)
        
      </div>
    </a>
  
  
    <a href="/2016/nodejs-1/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Node.js(1) 封装,调用,执行,访问路径,http,函数编程,等待函数,事件监听</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="nodejs-2" data-title="Node.js(2) MySQL" data-url="http://joname1.github.io/2016/nodejs-2/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"joname"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-right">
    		2016 <i class="fa fa-heart"></i> Joname. 我只作案,从不备案!
    	</div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: false,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
	}
</script>
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.0-beta.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=59279948" charset="UTF-8"></script>

<div id="totop" style="position:fixed;bottom:50px;right:30px;cursor: pointer;">
<a title="我要飞上去"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAYAAACoPemuAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjBBQjM1RjI2RkE5MzExRTBCNDZDODlFRTY3MTBGM0E0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjBBQjM1RjI3RkE5MzExRTBCNDZDODlFRTY3MTBGM0E0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MEFCMzVGMjRGQTkzMTFFMEI0NkM4OUVFNjcxMEYzQTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MEFCMzVGMjVGQTkzMTFFMEI0NkM4OUVFNjcxMEYzQTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7olMqSAAAG0klEQVR42oxYTWiURxie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">
</div>
<script src="/js/totop.js"></script>
  </div>
</body>
</html>