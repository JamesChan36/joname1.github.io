<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">

    <title>Node.js(2) MySQL</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="江矿宝宝的博客." />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Node.js(2) MySQL" />
    <meta property="og:description" content="MySQL是mysql-5.6.17  nodejs是目前最新版。 ①安装nodejs的mysql模块 如果你的nodejs的版本比较新的话，应该不存在安装路径问题； 在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）； 输入： npm install mysql 正常的话，应该出的是一个带树形结构的图，比如这样： 如果差别过大，可能是出问题了，那么新建一个js文件，把以下内容复制粘贴进去 注意修改mysql的账号名、密码，而端口号3306是默认的； var mysql  &#x3D; require(&#x27;mysql&#x27;);  //调用MySQL模块   //创建一个connection   var connection &#x3D; mysql.createConnection({       host     : &#x27;127.0.0.1&#x27;,       //主机       user     : &#x27;root&#x27;,               //MySQL认证用户名       password : &#x27;&#x27;,        //MySQL认证用户密码       port: &#x27;3306&#x27;,                   //端口号" />
    <meta property="og:url" content="http://localhost:2368/nodejs-2/" />
    <meta property="article:published_time" content="2015-10-02T08:22:00.000Z" />
    <meta property="article:modified_time" content="2017-05-27T10:17:40.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Node.js(2) MySQL" />
    <meta name="twitter:description" content="MySQL是mysql-5.6.17  nodejs是目前最新版。 ①安装nodejs的mysql模块 如果你的nodejs的版本比较新的话，应该不存在安装路径问题； 在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）； 输入： npm install mysql 正常的话，应该出的是一个带树形结构的图，比如这样： 如果差别过大，可能是出问题了，那么新建一个js文件，把以下内容复制粘贴进去 注意修改mysql的账号名、密码，而端口号3306是默认的； var mysql  &#x3D; require(&#x27;mysql&#x27;);  //调用MySQL模块   //创建一个connection   var connection &#x3D; mysql.createConnection({       host     : &#x27;127.0.0.1&#x27;,       //主机       user     : &#x27;root&#x27;,               //MySQL认证用户名       password : &#x27;&#x27;,        //MySQL认证用户密码       port: &#x27;3306&#x27;,                   //端口号" />
    <meta name="twitter:url" content="http://localhost:2368/nodejs-2/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="江矿宝宝." />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "江矿宝宝的博客.",
        "logo": "http://localhost:2368/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "江矿宝宝.",
        "image": {
            "@type": "ImageObject",
            "url": "https://joe-10005639.cossh.myqcloud.com/jkbb.jpg",
            "width": 600,
            "height": 600
        },
        "url": "http://localhost:2368/author/jkbb/",
        "sameAs": [
            "https://joname1.github.io"
        ],
        "description": "伪前端攻城狮, 喜欢钻研新技术."
    },
    "headline": "Node.js(2) MySQL",
    "url": "http://localhost:2368/nodejs-2/",
    "datePublished": "2015-10-02T08:22:00.000Z",
    "dateModified": "2017-05-27T10:17:40.000Z",
    "description": "MySQL是mysql-5.6.17  nodejs是目前最新版。 ①安装nodejs的mysql模块 如果你的nodejs的版本比较新的话，应该不存在安装路径问题； 在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）； 输入： npm install mysql 正常的话，应该出的是一个带树形结构的图，比如这样： 如果差别过大，可能是出问题了，那么新建一个js文件，把以下内容复制粘贴进去 注意修改mysql的账号名、密码，而端口号3306是默认的； var mysql  &#x3D; require(&#x27;mysql&#x27;);  //调用MySQL模块   //创建一个connection   var connection &#x3D; mysql.createConnection({       host     : &#x27;127.0.0.1&#x27;,       //主机       user     : &#x27;root&#x27;,               //MySQL认证用户名       password : &#x27;&#x27;,        //MySQL认证用户密码       port: &#x27;3306&#x27;,                   //端口号",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.11" />
    <link rel="alternate" type="application/rss+xml" title="江矿宝宝的博客." href="../../rss/index.html" />

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,600,400" />
    <style amp-custom>
        /* ==========================================================================
           Table of Contents
           ========================================================================== */

        /*

            0. Normalize
            1. General
            2. Utilities
            3. AMP Post
            4. Footer

        */

        /* ==========================================================================
           0. normalize.css v3.0.3 | MIT License | git.io/normalize | (minified)
           ========================================================================== */

        html {
            font-family: sans-serif;

            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
        }
        body {
            margin: 0;
        }
        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        main,
        menu,
        nav,
        section,
        summary {
            display: block;
        }
        audio,
        canvas,
        progress,
        video {
            display: inline-block;
            vertical-align: baseline;
        }
        audio:not([controls]) {
            display: none;
            height: 0;
        }
        [hidden],
        template {
            display: none;
        }
        a {
            background-color: transparent;
        }
        a:active,
        a:hover {
            outline: 0;
        }
        abbr[title] {
            border-bottom: 1px dotted;
        }
        b,
        strong {
            font-weight: bold;
        }
        dfn {
            font-style: italic;
        }
        h1 {
            margin: 0.67em 0;
            font-size: 2em;
        }
        mark {
            background: #ff0;
            color: #000;
        }
        small {
            font-size: 80%;
        }
        sub,
        sup {
            position: relative;
            vertical-align: baseline;
            font-size: 75%;
            line-height: 0;
        }
        sup {
            top: -0.5em;
        }
        sub {
            bottom: -0.25em;
        }
        img {
            border: 0;
        }
        amp-img {
            border: 0;
        }
        svg:not(:root) {
            overflow: hidden;
        }
        figure {
            margin: 1em 40px;
        }
        hr {
            box-sizing: content-box;
            height: 0;
        }
        pre {
            overflow: auto;
        }
        code,
        kbd,
        pre,
        samp {
            font-family: monospace, monospace;
            font-size: 1em;
        }
        button,
        input,
        optgroup,
        select,
        textarea {
            margin: 0;
            color: inherit;
            font: inherit;
        }
        button {
            overflow: visible;
        }
        button,
        select {
            text-transform: none;
        }
        button,
        html input[type="button"],
        input[type="reset"],
        input[type="submit"] {
            cursor: pointer;

            -webkit-appearance: button;
        }
        button[disabled],
        html input[disabled] {
            cursor: default;
        }
        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0;
        }
        input {
            line-height: normal;
        }
        input[type="checkbox"],
        input[type="radio"] {
            box-sizing: border-box;
            padding: 0;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            height: auto;
        }
        input[type="search"] {
            -webkit-appearance: textfield;
        }
        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-decoration {
            -webkit-appearance: none;
        }
        fieldset {
            margin: 0 2px;
            padding: 0.35em 0.625em 0.75em;
            border: 1px solid #c0c0c0;
        }
        legend {
            padding: 0;
            border: 0;
        }
        textarea {
            overflow: auto;
        }
        optgroup {
            font-weight: bold;
        }
        table {
            border-spacing: 0;
            border-collapse: collapse;
        }
        td,
        th {
            padding: 0;
        }


        /* ==========================================================================
           1. General - Setting up some base styles
           ========================================================================== */

        html {
            max-height: 100%;
            height: 100%;
            font-size: 62.5%;

            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        body {
            max-height: 100%;
            height: 100%;
            color: #3a4145;
            background: #f4f8fb;
            letter-spacing: 0.01rem;
            font-family: "Merriweather", serif;
            font-size: 1.8rem;
            line-height: 1.75em;
            text-rendering: geometricPrecision;

            -webkit-font-feature-settings: "kern" 1;
            -moz-font-feature-settings: "kern" 1;
            -o-font-feature-settings: "kern" 1;
        }

        ::-moz-selection {
            background: #d6edff;
        }

        ::selection {
            background: #d6edff;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0 0 0.3em 0;
            color: #2e2e2e;
            font-family: "Open Sans", sans-serif;
            line-height: 1.15em;
            text-rendering: geometricPrecision;

            -webkit-font-feature-settings: "dlig" 1, "liga" 1, "lnum" 1, "kern" 1;
            -moz-font-feature-settings: "dlig" 1, "liga" 1, "lnum" 1, "kern" 1;
            -o-font-feature-settings: "dlig" 1, "liga" 1, "lnum" 1, "kern" 1;
        }

        h1 {
            text-indent: -2px;
            letter-spacing: -1px;
            font-size: 2.6rem;
        }

        h2 {
            letter-spacing: 0;
            font-size: 2.4rem;
        }

        h3 {
            letter-spacing: -0.6px;
            font-size: 2.1rem;
        }

        h4 {
            font-size: 1.9rem;
        }

        h5 {
            font-size: 1.8rem;
        }

        h6 {
            font-size: 1.8rem;
        }

        a {
            color: #4a4a4a;
        }

        a:hover {
            color: #111;
        }

        p,
        ul,
        ol,
        dl {
            margin: 0 0 2.5rem 0;
            font-size: 1.5rem;
            text-rendering: geometricPrecision;

            -webkit-font-feature-settings: "liga" 1, "onum" 1, "kern" 1;
            -moz-font-feature-settings: "liga" 1, "onum" 1, "kern" 1;
            -o-font-feature-settings: "liga" 1, "onum" 1, "kern" 1;
        }

        ol,
        ul {
            padding-left: 2em;
        }

        ol ol,
        ul ul,
        ul ol,
        ol ul {
            margin: 0 0 0.4em 0;
            padding-left: 2em;
        }

        dl dt {
            float: left;
            clear: left;
            overflow: hidden;
            margin-bottom: 1em;
            width: 180px;
            text-align: right;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 700;
        }

        dl dd {
            margin-bottom: 1em;
            margin-left: 200px;
        }

        li {
            margin: 0.4em 0;
        }

        li li {
            margin: 0;
        }

        hr {
            display: block;
            margin: 1.75em 0;
            padding: 0;
            height: 1px;
            border: 0;
            border-top: #efefef 1px solid;
        }

        blockquote {
            box-sizing: border-box;
            margin: 1.75em 0 1.75em 0;
            padding: 0 0 0 1.75em;
            border-left: #4a4a4a 0.4em solid;

            -moz-box-sizing: border-box;
        }

        blockquote p {
            margin: 0.8em 0;
            font-style: italic;
        }

        blockquote small {
            display: inline-block;
            margin: 0.8em 0 0.8em 1.5em;
            color: #ccc;
            font-size: 0.9em;
        }

        blockquote small:before {
            content: "\2014 \00A0";
        }

        blockquote cite {
            font-weight: 700;
        }

        blockquote cite a {
            font-weight: normal;
        }

        mark {
            background-color: #fdffb6;
        }

        code,
        tt {
            padding: 1px 3px;
            border: #e3edf3 1px solid;
            background: #f7fafb;
            border-radius: 2px;
            white-space: pre-wrap;
            font-family: Inconsolata, monospace, sans-serif;
            font-size: 0.85em;
            font-feature-settings: "liga" 0;

            -webkit-font-feature-settings: "liga" 0;
            -moz-font-feature-settings: "liga" 0;
        }

        pre {
            overflow: auto;
            box-sizing: border-box;
            margin: 0 0 1.75em 0;
            padding: 10px;
            width: 100%;
            border: #e3edf3 1px solid;
            background: #f7fafb;
            border-radius: 3px;
            white-space: pre;
            font-family: Inconsolata, monospace, sans-serif;
            font-size: 0.9em;

            -moz-box-sizing: border-box;
        }

        pre code,
        pre tt {
            padding: 0;
            border: none;
            background: transparent;
            white-space: pre-wrap;
            font-size: inherit;
        }

        kbd {
            display: inline-block;
            margin-bottom: 0.4em;
            padding: 1px 8px;
            border: #ccc 1px solid;
            background: #f4f4f4;
            border-radius: 4px;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2),
            0 1px 0 0 #fff inset;
            color: #666;
            text-shadow: #fff 0 1px 0;
            font-size: 0.9em;
            font-weight: 700;
        }

        table {
            box-sizing: border-box;
            margin: 1.75em 0;
            max-width: 100%;
            width: 100%;
            background-color: transparent;

            -moz-box-sizing: border-box;
        }

        table th,
        table td {
            padding: 8px;
            border-top: #efefef 1px solid;
            vertical-align: top;
            text-align: left;
            line-height: 20px;
        }

        table th {
            color: #000;
        }

        table caption + thead tr:first-child th,
        table caption + thead tr:first-child td,
        table colgroup + thead tr:first-child th,
        table colgroup + thead tr:first-child td,
        table thead:first-child tr:first-child th,
        table thead:first-child tr:first-child td {
            border-top: 0;
        }

        table tbody + tbody {
            border-top: #efefef 2px solid;
        }

        table table table {
            background-color: #fff;
        }

        table tbody > tr:nth-child(odd) > td,
        table tbody > tr:nth-child(odd) > th {
            background-color: #f6f6f6;
        }

        table.plain tbody > tr:nth-child(odd) > td,
        table.plain tbody > tr:nth-child(odd) > th {
            background: transparent;
        }

        iframe,
        amp-iframe,
        .fluid-width-video-wrapper {
            display: block;
            margin: 1.75em 0;
        }

        /* When a video is inside the fitvids wrapper, drop the
        margin on the iframe, cause it breaks stuff. */
        .fluid-width-video-wrapper iframe,
        .fluid-width-video-wrapper amp-iframe {
            margin: 0;
        }

        textarea,
        select,
        input {
            margin: 0 0 5px 0;
            padding: 6px 9px;
            width: 260px;
            outline: 0;
            border: #e7eef2 1px solid;
            background: #fff;
            border-radius: 4px;
            box-shadow: none;
            font-family: "Open Sans", sans-serif;
            font-size: 1.6rem;
            line-height: 1.4em;
            font-weight: 100;

            -webkit-appearance: none;
        }

        textarea {
            min-width: 250px;
            min-height: 80px;
            max-width: 340px;
            width: 100%;
            height: auto;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="search"]:focus,
        input[type="tel"]:focus,
        input[type="url"]:focus,
        input[type="password"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="month"]:focus,
        input[type="week"]:focus,
        input[type="time"]:focus,
        input[type="datetime"]:focus,
        input[type="datetime-local"]:focus,
        textarea:focus {
            outline: none;
            outline-width: 0;
            border: #bbc7cc 1px solid;
            background: #fff;
        }

        select {
            width: 270px;
            height: 30px;
            line-height: 30px;
        }

        /* ==========================================================================
           2. Utilities
           ========================================================================== */

        /* Clears shit */
        .clearfix:before,
        .clearfix:after {
            content: " ";
            display: table;
        }
        .clearfix:after {
            clear: both;
        }
        .clearfix {
            zoom: 1;
        }

        /* ==========================================================================
           3. AMP Post
           ========================================================================== */



        .main-header {
            position: relative;
            display: table;
            overflow: hidden;
            box-sizing: border-box;
            width: 100%;
            height: 50px;
            background: #5ba4e5 no-repeat center center;
            background-size: cover;
            text-align: left;

            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        .content {
            background: #fff;
            padding-top: 15px;
        }
        .blog-title,
        .content {
            margin: auto;
            max-width: 600px;
        }

        .blog-title a {
            display: block;
            padding-right: 16px;
            padding-left: 16px;
            height: 50px;
            color: #fff;
            text-decoration: none;
            font-family: "Open Sans", sans-serif;
            font-size: 16px;
            line-height: 50px;
            font-weight: 600;
        }

        .post {
            position: relative;
            margin-top: 0;
            margin-right: 16px;
            margin-left: 16px;
            padding-bottom: 0;
            max-width: 100%;
            border-bottom: #ebf2f6 1px solid;
            word-wrap: break-word;
            font-size: 0.95em;
            line-height: 1.65em;
        }

        .post-header {
            margin-bottom: 1rem;
        }

        .post-title {
            margin-bottom: 0;
        }

        .post-title a {
            text-decoration: none;
        }

        .post-meta {
            display: block;
            margin: 3px 0 0 0;
            color: #9eabb3;
            font-family: "Open Sans", sans-serif;
            font-size: 1.3rem;
            line-height: 2.2rem;
        }

        .post-meta a {
            color: #9eabb3;
            text-decoration: none;
        }

        .post-meta a:hover {
            text-decoration: underline;
        }

        .post-meta .author {
            margin: 0;
            font-size: 1.3rem;
            line-height: 1.3em;
        }

        .post-date {
            display: inline-block;
            text-transform: uppercase;
            white-space: nowrap;
            font-size: 1.2rem;
            line-height: 1.2em;
        }

        .post-image {
            margin: 0;
            padding-top: 3rem;
            padding-bottom: 30px;
            border-top: 1px #E8E8E8 solid;
        }

        /* Keep images centered, and allow images wider than the main
           text column to break out. */
        .post-content amp-img,
        .post-content amp-anim {
            /* Centers an image by (1) pushing its left edge to the
               center of its container and (2) shifting the entire image
               in the opposite direction by half its own width.
               Works for images that are larger than their containers. */
            position: relative;
            left: 50%;
            display: block;
            padding: 0;
            min-width: 0;
            max-width: 112%; /* fallback when calc doesn't work */
            width: calc(100% + 32px); /* expand with to image + margins */
            height: auto;
            transform: translateX(-50%);

            -webkit-transform: translateX(-50%); /* for Safari and iOS */
            -ms-transform: translateX(-50%); /* for IE9 */
        }

        .footnotes {
            font-size: 1.3rem;
            line-height: 1.6em;
            font-style: italic;
        }

        .footnotes li {
            margin: 0.6rem 0;
        }

        .footnotes p {
            margin: 0;
        }

        .footnotes p a:last-child {
            text-decoration: none;
        }

        /* ==========================================================================
           4. Footer - The bottom the AMP Post
           ========================================================================== */

        .site-footer {
            position: relative;
            margin: 0 auto 20px auto;
            padding: 1rem 15px;
            max-width: 600px;
            color: rgba(0,0,0,0.5);
            font-family: "Open Sans", sans-serif;
            font-size: 1.1rem;
            line-height: 1.75em;
        }

        .site-footer a {
            color: rgba(0,0,0,0.5);
            text-decoration: none;
            font-weight: bold;
        }

        .site-footer a:hover {
            border-bottom: #bbc7cc 1px solid;
        }

        .poweredby {
            display: block;
            float: right;
            width: 45%;
            text-align: right;
        }

        .copyright {
            display: block;
            float: left;
            width: 45%;
        }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../index.html">江矿宝宝的博客.</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Node.js(2) MySQL</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../author/jkbb/index.html">江矿宝宝.</a></p>
                    <time class="post-date" datetime="2015-10-02">2015-10-02</time>
                </section>
            </header>
            <section class="post-content">

                <p>MySQL是mysql-5.6.17 <br></br>
nodejs是目前最新版。</p>

<h1 id="nodejsmysql">①安装nodejs的mysql模块</h1>

<p>如果你的nodejs的版本比较新的话，应该不存在安装路径问题；
在你想要运行nodejs文件的根路径，启动命令行（shift+鼠标右键）；
输入：
<code>npm install mysql</code></p>

<p>正常的话，应该出的是一个带树形结构的图，比如这样：
</p>

<p>如果差别过大，可能是出问题了，那么新建一个js文件，把以下内容复制粘贴进去
注意修改mysql的账号名、密码，而端口号3306是默认的；</p>

<pre><code class="language-js">var mysql  = require('mysql');  //调用MySQL模块  

//创建一个connection  
var connection = mysql.createConnection({  
    host     : '127.0.0.1',       //主机  
    user     : 'root',               //MySQL认证用户名  
    password : '',        //MySQL认证用户密码  
    port: '3306',                   //端口号  
});  
//创建一个connection  
connection.connect(function(err){  
    if(err){  
        console.log('[query] - :'+err);  
        return;  
    }  
    console.log('[connection connect]  succeed!');  
});  
//执行SQL语句  
connection.query('SELECT 1 + 1 AS solution', function(err, rows, fields) {  
    if (err) {  
        console.log('[query] - :'+err);  
        return;  
    }  
    console.log('The solution is: ', rows[0].solution);  
});  
//关闭connection  
connection.end(function(err){  
    if(err){  
        return;  
    }  
    console.log('[connection end] succeed!');  
});  
</code></pre>

<p>如果正常运行的话，可以从控制台console.log出来的消息确认（具体请看代码）；</p>

<h1 id="mysqladd">②mysql的增add：</h1>

<p>假如我想在mysql里，数据库（database）名为test，表名为a<em>test</em>table插入数据。
假设你只装了mysql，却不懂mysql，那么这里我推荐你安装mysql-5.6.17-winx64这个版本，这样可以保证代码正常执行。
然后进入mysql，默认账号名为root，默认密码为空；
【以下代码注意结尾的分号，分号表示一条命令的结束】</p>

<p>输入showdatabases;
可以查看库名。应该有一个test库，如下图：

如果没有的话，请自行搜索如何创建一个库；
然后输入usetest;
进入test表；然后输入show tables;
显示test库下面的所有表，如下图：
</p>

<p>当然，正常来说，你这里应该是空。于是我们需要建表，为了方便，建一个最简单的表，输入以下命令：
create table a<em>test</em>table( <br></br>
id int, <br></br>
name varchar(20)); <br></br>
创建一个表，他只有两个字段，分别是id（int类型表示数字），name（字符类型）。此时再打show tables;  便可以看到a<em>test</em>table这个表了；
再输入elect* from a<em>test</em>table;
查询表内容，会显示空：
</p>

<p>下来开始正文，如何在这个表里插入内容：
首先，新建一个js文件，记得使用utf-8格式。
下面是代码，具体请看注释：</p>

<pre><code class="language-js">var mysql = require('mysql');  //调用MySQL模块  

//创建一个connection  
var connection = mysql.createConnection({  
    host: '127.0.0.1',       //主机地址  
    user: 'root',               //MySQL认证用户名  
    password: '',        //MySQL认证用户密码  
    port: '3306',                   //端口号  
    database: 'test',                //库名  
});  
//创建一个connection，即连接到mysql的对象，如果连接错误，会提示错误。  
connection.connect(function (err) {  
    if (err) {  
        console.log('[query] - :' + err);  
        return;  
    }  
    console.log('[connection connect]  succeed!');  
});  

var userAddSql = 'INSERT INTO a_test_table(id, name) VALUES(?,?)';  
/* 
这里实际上是一个mysql语句， 
关键是第三个a_table_test表示表名； 
id和name表示字段名；  
两个问号表示插入的值，如果不是问号，而是一个值，那么表示这个字段固定插入这个值 
*/  
var userAddSql_value = [1, 'wddddd'];       //这里实际依次对应的是上面2个问号，因为id是int，所以第一个是数字，第二个是字符串  

connection.query(userAddSql, userAddSql_value, function (err, result) {  
    if (err) {  
        console.log('[INSERT ERROR] - ', err.message);  
        return;  
    }  

    console.log('——————————————INSERT————————————————');  
    console.log('INSERT ID: ', result);  
    console.log('—————————————————————————————————');  
})  

//关闭connection  
connection.end(function (err) {  
    if (err) {  
        return;  
    }  
    console.log('[connection end] succeed!');  
});  
</code></pre>

<p>如果显示错误，请检查自己的nodejs代码，一般问题常发生在账号名、密码、库名、表名等。</p>

<h1 id="select">③查select：</h1>

<p>有没有发现代码的特点，他的关键是mysql的命令，只要我们更改命令，完全可以像直接在mysql里输入命令行一样操控mysql，例如，我们只需要改这么一段代码：</p>

<pre><code class="language-js">var userAddSql = 'SELECT * FORM a_test_table';  
</code></pre>

<p>即使完全不动其他代码，那么回调函数也能正常运行，其表现应该是这样：

当然，完全不改是不好的，但无论如何，我们需要的功能是实现了。
另外，显而易见，我们需要对返回内容进行操纵，那么首先我们需要明确返回内容是什么？结论是，他是一个数组（从 [] 可以猜出），然后我们这个数组只有一项，因此加上下标[0]，假如我们需要获取name属性，那么就是result[0].name；
总得来说，代码在之前的基础上这么修改：
把</p>

<pre><code class="language-js">console.log('INSERT ID: ', result);  
</code></pre>

<p>修改为：</p>

<pre><code class="language-js">console.log(result[0].name);  
</code></pre>

<p>然后再次执行js文件，显示结果应该是这样：
</p>

<h1 id="delete">④删delete</h1>

<p>是不是感觉很简单，让我们Go on
这次我们要删除id=1的那一项（因为id是唯一的，不会删错）——虽然我们其实就一项
在之前代码上继续修改：</p>

<pre><code class="language-js">var userAddSql = 'DELETE FROM a_test_table WHERE id = 1';  //之所以大写mysql的指令，是为了和数据区分，事实上不大写也是可以的  
</code></pre>

<p>然后执行之；
毫无疑问，代码会报错，但是并非我们删除命令错误了，而是因为之前的代码，会输出结果的name属性，显然咯，都被删除了，哪有name属性；
为了证明我们删除命令并没错，在mysql里进行查询：

我们可以发现，我们需要删除的那一项被删除了。</p>

<h1 id="update">⑤改update</h1>

<p>增删查改，我们只剩下改了。但是目前mysql表里没内容，我们需要重新加上一些mysql信息。
一次插入多条数据：</p>

<pre><code class="language-js">var userAddSql_value = [[1, 'a'], [2, 'd']];  

for (var i = 0; i &lt; userAddSql_value.length; i++) {  
    connection.query(userAddSql, userAddSql_value[i], function (err, result) {  
        if (err) {  
            console.log('[INSERT ERROR] - ', err.message);  
            return;  
        }  

        console.log('——————————————INSERT————————————————');  
        console.log(result[0].name);  
        console.log('—————————————————————————————————');  
    })  
}  
</code></pre>

<p>然后接下来，我们要修改数据了。
我们这次的目的，是把id=1的项，name修改为pp
需要注意的是，所有id=1的项，name属性都将被修改为pp（而不是仅仅只有一个）；</p>

<pre><code class="language-js">var userAddSql = 'UPDATE a_test_table SET name = ? WHERE id = ?';  
var userAddSql_value = [&quot;pp&quot;, 1];  
connection.query(userAddSql, userAddSql_value, function (err, result) {  
    if (err) {  
        console.log('[INSERT ERROR] - ', err.message);  
        return;  
    }  

    console.log('——————————————INSERT————————————————');  
    console.log('INSERT ID: ', result);  
    console.log('—————————————————————————————————');  
})  
</code></pre>

<p>运行之，然后再查表，正常的话，你会发现，id=1的项，其值被更为为了pp
</p>

<h1 id>⑥断线重连</h1>

<p>按照说明，使用连接池的方法更好，不过既然看到了断线重连，虽然挺迷茫，但正常运行了（虽然并不明白，而且感觉有点出入），那就先用着
代码这么写：</p>

<pre><code class="language-js">var mysql = require('mysql');  //调用MySQL模块  

//创建一个connection  
var db_config = mysql.createConnection({  
    host: '127.0.0.1',       //主机地址  
    user: 'root',               //MySQL认证用户名  
    password: '',        //MySQL认证用户密码  
    port: '3306',                   //端口号  
    database: 'test',                //库名  
});  
var connect;  
function handleDisconnect() {  
    connect = mysql.createConnection(db_config);    //创建连接（连接的设置是上面）  
    connect.connect(function (err) {    //大概是指连接，  
        if (err) {  
            console.log(&quot;正在连接中：&quot; + new Date());  
            setTimeout(handleDisconnect, 3000);  
            return;  
        }  
        console.log(&quot;连接成功&quot;);  
        run();  
    })  
    connect.on('error', function (err) {  
        console.log('db error', err);  
        if (err.code === 'PROTOCOL_CONNECTION_SET') {  
            handleDisconnect();  
        } else {  
            throw err;  
        }  
    })  
}  
handleDisconnect();  
function run() {  
    db_config.connect(function (err) {  
        if (err) {  
            console.log('[query] - :' + err);  
            return;  
        }  
        console.log('[connection connect]  succeed!');  
    });  

    var userAddSql = 'UPDATE a_test_table SET name = ? WHERE id = ?';  
    var userAddSql_value = [&quot;www&quot;, 1];  

    db_config.query(userAddSql, userAddSql_value, function (err, result) {  
        if (err) {  
            console.log('[INSERT ERROR] - ', err.message);  
            return;  
        }  

        console.log('——————————————INSERT————————————————');  
        console.log('INSERT ID: ', result);  
        console.log('—————————————————————————————————');  
    })  


//关闭connection  
    db_config.end(function (err) {  
        if (err) {  
            return;  
        }  
        console.log('[connection end] succeed!');  
    });  
}  
</code></pre>

<h1 id>⑦连接池：</h1>

<p>然后我试了试连接池的方法：</p>

<pre><code class="language-js">var mysql = require('mysql');  
var pool = mysql.createPool({  
    host: 'localhost',  
    user: 'root',  
    password: '',  
    database: 'test',  
    debug: false,  
});  

var insert = function (connection, data) {  
    connection.query('INSERT INTO a_test_table SET ?', data, function (err, result) {  
        console.log('ID : ' + result.insertId);  
    });  
};  

var update = function (connection, data) {  
    connection.query('UPDATE a_test_table SET name = ? WHERE id = ?', data, function (err, result) {  
    });  
};  

var select = function (connection) {  
    connection.query('SELECT * FROM a_test_table', function (err, result) {  
        result.forEach(function (user) {  
            console.log(user.id + ':' + user.name + ':');  
        });  
    });  
};  

pool.getConnection(function (err, connection) {  
    var data = ['www', 1];  
    select(connection);  
    update(connection, data);  
    select(connection);  
});  

console.log('mysql is start!');  
</code></pre>

<p>
然后我尝试停用了mysql，运行这段代码，发现，停用后无法连接，并报错；如果是正在连接，那么会自动断掉连接。</p>

<p>不是很明白如何断线重连。</p>

<p>也许是假如断线了，就运行这个pool.getConnection这句代码？
但是如何判断呢？不清楚</p>

<p>像下面这么写么？假如没连上，的确可以尝试重复连接，但是如果连接上的时候，断掉了，却不会继续重连。</p>

<pre><code class="language-js">function toConnet() {  
    pool.getConnection(function (err, connection) {  
        if (err) {  
            console.log(&quot;连接中：&quot; + err);  
            setTimeout(toConnet, 2000);  
        } else {  
            var data = ['bbbb', 1];  
            select(connection);  
            update(connection, data);  
            select(connection);  
        }  
    })  
}  
toConnet();  
</code></pre>

<p>下面的表示链接成功了
</p>

<h1 id="sql">⑧防止SQL注入：</h1>

<p>使用方法：escape()
具体用法是：
不过貌似nodejs本身就带有一定的防注入功能。例如，我把data改为：</p>

<pre><code class="language-js">var data = [&quot;'bbbb', id = 2&quot;, 1];  
</code></pre>

<p>这样拼接出来的sql代码应该是：
UPDATE a<em>test</em>table SET name = 'bbbb', id = 2 WHERE id = 1 <br></br>
运行这个js文件后，会发现结果变成这样：

但若在mysql里面运行这段代码：
结果变成这样：

说明我们拼接的代码是没错的，只是mysql防止了这种简单的sql注入攻击。</p>

            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../index.html">江矿宝宝的博客.</a> &copy; 2017</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
</html>
